<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISR Explorer</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/images/logo.svg" />
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
    <link rel="manifest" href="/images/site.webmanifest" />
    <!-- MathJax for LaTeX formula rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #334155;
        }

        /* Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 350px;
            max-height: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
        }

        /* Transitions */
        .tab-active {
            background-color: #2563eb;
            color: white;
        }

        .tab-inactive {
            background-color: transparent;
            color: #64748b;
        }

        .tab-inactive:hover {
            background-color: #e2e8f0;
            color: #334155;
        }

        /* Map Canvas */
        #simCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
    </style>
    <!-- Chosen Palette: Slate & Blue with Component Colors (Red, Green, Purple, Orange) -->
    <!-- Application Structure Plan:
     1. Data Layer: Generates 20 profiles with multi-dimensional attributes.
     2. Tab 1 (Input): Profile Inspector with a complex 4-layer Radar Chart (D, G, S, X) on abstract axes.
     3. Tab 2 (Simulator): Scenario selector with detailed descriptions. 
        - Visuals: Live Map showing all 20 users (Member vs Non-Member).
        - Interaction: Slider changes threshold -> updates Map & List.
-->
    <!-- Visualization & Content Choices:
     - Radar Chart: 4 Datasets (D/G/S/X), Circular Grid, No Axis Labels. Shows multi-dimensional nature.
     - Map: Canvas rendering of 2D space. Red zones = Issue. Blue dots = Members. Grey dots = Others.
     - Logic: Descriptions explain WHY relevance is calculated (e.g., "Heavily weighted on location...").
-->
    <!-- CONFIRMATION: NO SVG graphics used (except Icons). NO Mermaid JS used. -->
</head>

<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 px-6 py-4 flex justify-between items-center shadow-sm z-10">
        <div>
            <a href="/">
                <img src="../images/isr-logo.png" alt="ISR homepage" width=70 height=20>
            </a>
        </div>
        <div>
            <h4 class="text-2xl font-bold text-slate-800 tracking-tight">Explorer</h4>
            <!--<p class="text-sm text-slate-500">Relevance Engine & Microcommunity Formation</p>-->
        </div>
        <div class="flex space-x-1 bg-slate-100 p-1 rounded-lg">
            <button id="nav-profiles" onclick="switchTab('profiles')"
                class="tab-active px-4 py-2 rounded-md text-sm font-medium transition-all">Profiles</button>
            <button id="nav-sim" onclick="switchTab('sim')"
                class="tab-inactive px-4 py-2 rounded-md text-sm font-medium transition-all">Relevance</button>
            <button id="nav-expertise" onclick="switchTab('expertise')"
                class="tab-inactive px-4 py-2 rounded-md text-sm font-medium transition-all">Expertise</button>
            <button id="nav-values" onclick="switchTab('values')"
                class="tab-inactive px-4 py-2 rounded-md text-sm font-medium transition-all">Vector of Values</button>
            <button id="nav-contribution" onclick="switchTab('contribution')"
                class="tab-inactive px-4 py-2 rounded-md text-sm font-medium transition-all">Contribution</button>
            <button id="nav-isr-complete" onclick="switchTab('isr-complete')"
                class="tab-inactive px-4 py-2 rounded-md text-sm font-medium transition-all">ISR ready-to-vote</button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 relative overflow-hidden bg-slate-50">

        <!-- VIEW 1: PROFILES (INPUT) -->
        <section id="view-profiles" class="absolute inset-0 p-6 grid grid-cols-12 gap-6">
            <!-- Left: Profile List -->
            <div
                class="col-span-12 md:col-span-4 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col overflow-hidden">
                <div class="p-4 border-b border-slate-100 bg-slate-50">
                    <h4 class="font-semibold text-slate-700">User Database (20)</h4>
                    <p class="text-xs text-slate-500 mt-1">Select a profile to inspect their Multi-dimensional Vector
                        (P)</p>
                </div>
                <div id="profile-list" class="flex-1 overflow-y-auto custom-scroll p-2 space-y-2">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Right: Profile Inspector (Vector Viz) -->
            <div
                class="col-span-12 md:col-span-8 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col overflow-hidden">
                <div class="p-6 border-b border-slate-100 flex justify-between items-start">
                    <div>
                        <h4 id="inspector-name" class="text-2xl font-bold text-slate-800">Select a Profile</h4>
                        <div id="inspector-badges" class="flex flex-wrap gap-2 mt-2"></div>
                    </div>
                    <div class="text-right">
                        <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider">User ID</span>
                        <div id="inspector-id" class="font-mono text-slate-600">--</div>
                    </div>
                </div>

                <div class="flex-1 p-6 overflow-y-auto">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center h-full">
                        <!-- Chart Section -->
                        <div class="flex flex-col items-center justify-center relative">
                            <h3 class="text-sm font-semibold text-slate-500 mb-2 uppercase tracking-wider">
                                Multi-Dimensional Person Vector</h3>

                            <!-- Legend -->
                            <div class="flex flex-wrap justify-center gap-3 mb-2 text-xs">
                                <span class="flex items-center"><span
                                        class="w-3 h-3 rounded-full bg-blue-500 mr-1"></span> Demographics (D)</span>
                                <span class="flex items-center"><span
                                        class="w-3 h-3 rounded-full bg-emerald-500 mr-1"></span> Geospatial (G)</span>
                                <span class="flex items-center"><span
                                        class="w-3 h-3 rounded-full bg-purple-500 mr-1"></span> Social (S)</span>
                                <span class="flex items-center"><span
                                        class="w-3 h-3 rounded-full bg-orange-500 mr-1"></span> Semantic (X)</span>
                            </div>

                            <div class="chart-container">
                                <canvas id="profileRadarChart"></canvas>
                            </div>
                            <p class="text-xs text-slate-400 mt-2 text-center max-w-xs">
                                Visualizes the complexity of the user's profile across 4 dimension clasters.
                            </p>
                        </div>

                        <!-- Data Section -->
                        <div class="space-y-6 bg-slate-50 p-6 rounded-lg border border-slate-100">
                            <div>
                                <h4 class="text-sm font-bold text-blue-700 mb-2 border-b border-blue-100 pb-1">
                                    Demographics (D)</h4>
                                <ul id="inspector-demo" class="text-sm text-slate-600 space-y-1"></ul>
                            </div>
                            <div>
                                <h4 class="text-sm font-bold text-emerald-700 mb-2 border-b border-emerald-100 pb-1">
                                    Geospatial Anchors (G)</h4>
                                <ul id="inspector-geo" class="text-sm text-slate-600 space-y-1"></ul>
                            </div>
                            <div>
                                <h4 class="text-sm font-bold text-orange-700 mb-2 border-b border-orange-100 pb-1">
                                    Interests & Semantics (X)</h4>
                                <div id="inspector-interests" class="flex flex-wrap gap-2"></div>
                            </div>
                            <div>
                                <h4 class="text-sm font-bold text-indigo-700 mb-2 border-b border-indigo-100 pb-1">
                                    Expertise (E)</h4>
                                <div id="inspector-expertise" class="text-sm text-slate-600 mb-2"></div>
                                <button onclick="openExpertiseModal(currentProfile)"
                                    class="text-xs font-bold text-indigo-600 hover:text-indigo-800 underline">View
                                    Details</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>


        <!-- VIEW 2: RELEVANCE SIMULATOR -->
        <section id="view-sim" class="hidden absolute inset-0 p-6 flex flex-col">
            <!-- Top Controls -->
            <div class="grid grid-cols-12 gap-6 mb-6">
                <!-- Scenario Selector & Desc -->
                <div class="col-span-12 lg:col-span-9 bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button onclick="setIssue(0)" id="btn-issue-0"
                            class="flex-1 px-4 py-2 rounded-lg text-sm font-bold bg-blue-600 text-white shadow-sm transition-all">1.
                            Local Park</button>
                        <button onclick="setIssue(1)" id="btn-issue-1"
                            class="flex-1 px-4 py-2 rounded-lg text-sm font-bold bg-white border border-slate-300 text-slate-600 hover:bg-slate-50">2.
                            Remote Work</button>
                        <button onclick="setIssue(2)" id="btn-issue-2"
                            class="flex-1 px-4 py-2 rounded-lg text-sm font-bold bg-white border border-slate-300 text-slate-600 hover:bg-slate-50">3.
                            Elderly Care</button>
                    </div>

                    <div class="bg-slate-50 p-4 rounded border border-slate-200">
                        <h3 id="scenario-title" class="font-bold text-slate-800 text-lg mb-1">Scenario Title</h3>
                        <p id="scenario-desc" class="text-sm text-slate-600 mb-2">Description goes here.</p>
                        <div class="text-xs text-slate-500 pt-2 border-t border-slate-200">
                            <strong>Calculation Logic:</strong> <span id="scenario-logic">Logic goes here.</span>
                        </div>
                    </div>
                </div>

                <!-- Threshold & Weights -->
                <div
                    class="col-span-12 lg:col-span-3 bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-between">
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-bold text-slate-700">Relevance Threshold</span>
                            <span id="thresholdValue"
                                class="text-sm font-mono font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded">0.50</span>
                        </div>
                        <input type="range" id="thresholdSlider" min="0" max="100" value="50"
                            class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600 mb-4">
                    </div>

                    <span class="text-sm text-slate-700"><b>Weights balance</b> is issue context dependent</span>
                    <div class="grid grid-cols-4 gap-2 text-center">
                        <div class="p-2 bg-blue-50 rounded border border-blue-100">
                            <div class="text-[10px] text-blue-500 font-bold">DEMO</div>
                            <div id="weight-d" class="text-sm font-bold text-slate-800">--</div>
                        </div>
                        <div class="p-2 bg-emerald-50 rounded border border-emerald-100">
                            <div class="text-[10px] text-emerald-600 font-bold">GEO</div>
                            <div id="weight-g" class="text-sm font-bold text-slate-800">--</div>
                        </div>
                        <div class="p-2 bg-purple-50 rounded border border-purple-100">
                            <div class="text-[10px] text-purple-500 font-bold">SOC</div>
                            <div id="weight-s" class="text-sm font-bold text-slate-800">--</div>
                        </div>
                        <div class="p-2 bg-orange-50 rounded border border-orange-100">
                            <div class="text-[10px] text-orange-600 font-bold">INT</div>
                            <div id="weight-x" class="text-sm font-bold text-slate-800">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div class="flex-1 grid grid-cols-12 gap-6 min-h-0">
                <!-- Left: Map -->
                <div class="col-span-12 lg:col-span-9 flex flex-col">
                    <div
                        class="flex-1 bg-white rounded-xl shadow-sm border border-slate-200 relative overflow-hidden flex flex-col">
                        <!-- Map Legend -->
                        <div
                            class="absolute top-4 left-4 z-10 bg-white/95 backdrop-blur px-3 py-2 rounded-lg shadow border border-slate-200 text-xs">
                            <div class="font-bold mb-1 text-slate-700">Map Key</div>
                            <div class="flex items-center mb-1"><span
                                    class="w-2 h-2 rounded-full bg-blue-600 mr-2"></span> Member (R > T)</div>
                            <div class="flex items-center mb-1"><span
                                    class="w-2 h-2 rounded-full bg-slate-300 mr-2"></span> Non-Member</div>
                            <div class="flex items-center"><span
                                    class="w-3 h-3 border-2 border-red-500 rounded-full mr-1.5 opacity-50"></span>
                                Impact Radius</div>
                        </div>

                        <!-- The Canvas -->
                        <div class="relative w-full h-full bg-slate-50">
                            <canvas id="simCanvas"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Right: Microcommunity List -->
                <div
                    class="col-span-12 lg:col-span-3 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col overflow-hidden">
                    <div class="p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                        <div>
                            <h4 class="font-bold text-slate-700">Microcommunity</h4>
                            <p class="text-xs text-slate-500">Filtered by Relevance</p>
                        </div>
                        <span id="member-count"
                            class="bg-blue-100 text-blue-700 text-xs font-bold px-2 py-1 rounded-full">0/20</span>
                    </div>
                    <div class="flex-1 overflow-y-auto custom-scroll p-0" id="microcommunity-list">
                        <!-- Populated by JS -->
                    </div>
                    <!-- <div class="p-3 bg-blue-50 text-center border-t border-blue-100">
                        <p class="text-xs text-blue-600 font-medium">Click a user for Factor Analysis</p>
                    </div> -->
                </div>
            </div>
        </section>


        <!-- VIEW 3: EXPERTISE ASSESSMENT -->
        <section id="view-expertise" class="hidden absolute inset-0 p-6 flex flex-col overflow-hidden">
            <!-- 3-Column Layout -->
            <div class="flex-1 grid grid-cols-12 gap-6 min-h-0">

                <!-- LEFT BLOCK: Issue Requirements -->
                <div
                    class="col-span-12 lg:col-span-3 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col overflow-hidden">
                    <div class="p-4 border-b border-slate-100 bg-slate-50">
                        <h4 class="font-bold text-slate-700">Issue Requirements</h4>
                        <p class="text-xs text-slate-500">Target Profile Definition</p>
                    </div>

                    <!-- Issue Selector -->
                    <div class="p-4 border-b border-slate-100 grid grid-cols-3 gap-2">
                        <button onclick="switchIssueExpertise(0)" id="btn-exp-0"
                            class="px-2 py-2 rounded text-xs font-bold bg-blue-600 text-white shadow-sm truncate transition-all">Park</button>
                        <button onclick="switchIssueExpertise(1)" id="btn-exp-1"
                            class="px-2 py-2 rounded text-xs font-bold bg-white border border-slate-300 text-slate-600 hover:bg-slate-50 truncate transition-all">Remote</button>
                        <button onclick="switchIssueExpertise(2)" id="btn-exp-2"
                            class="px-2 py-2 rounded text-xs font-bold bg-white border border-slate-300 text-slate-600 hover:bg-slate-50 truncate transition-all">Health</button>
                    </div>

                    <div class="flex-1 overflow-y-auto custom-scroll p-4 space-y-6">
                        <!-- Issue Header -->
                        <div>
                            <div class="text-xs font-bold text-blue-600 uppercase mb-1" id="exp-issue-category">CATEGORY
                            </div>
                            <h2 class="text-xl font-bold text-slate-800 leading-tight mb-2" id="exp-issue-title">Issue
                                Title</h2>
                            <p class="text-sm text-slate-600" id="exp-issue-desc">Issue Description.</p>
                        </div>

                        <!-- 1. Education Target -->
                        <div>
                            <h4 class="text-xs font-bold text-slate-600 uppercase mb-2">Required Knowledge</h4>
                            <div id="exp-target-sphere"
                                class="w-65 h-64 mx-auto relative flex items-center justify-center bg-slate-50 rounded-lg border border-slate-100">
                                <!-- D3 Viz -->
                            </div>
                            <!-- <div class="text-center mt-1 text-xs text-slate-500" id="exp-target-angle">Angle: 0° (+/-
                                0°)</div> -->
                        </div>

                        <!-- 2. Experience Target -->
                        <div>
                            <h4 class="text-xs font-bold text-slate-600 uppercase mb-2">Required Experience</h4>
                            <div class="flex items-center">
                                <span class="text-2xl font-bold text-slate-700 mr-2" id="exp-target-years">0</span>
                                <span class="text-sm text-slate-500">Years Min.</span>
                            </div>
                            <div class="w-full bg-slate-200 h-1.5 rounded-full mt-1">
                                <div class="bg-slate-400 h-1.5 rounded-full w-full opacity-50"></div>
                            </div>
                        </div>

                        <!-- 3. Resource Target -->
                        <div>
                            <h4 class="text-xs font-bold text-slate-600 uppercase mb-2">Required Resources</h4>
                            <div id="exp-target-resources" class="flex flex-wrap gap-2"></div>
                        </div>
                    </div>
                </div>

                <!-- CENTER BLOCK: Comparative Analysis -->
                <div class="col-span-12 lg:col-span-7 flex flex-col">
                    <div id="compare-container"
                        class="bg-white rounded-xl shadow-sm border border-slate-200 flex-1 flex flex-col h-[500px] min-h-0 overflow-hidden">
                        <div class="p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-slate-700">Comparative Analysis</h4>
                                <p class="text-xs text-slate-500">Member vs Issue Gap</p>
                            </div>
                            <div id="comp-user-badge" class="hidden text-xl text-blue-700 font-bold px-2 py-1 rounded">
                                <span id="comp-username">Name</span>
                            </div>
                        </div>

                        <!-- Empty State -->
                        <div id="comp-empty-state"
                            class="flex-1 flex flex-col items-center justify-center p-10 text-center text-slate-400">
                            <svg class="w-12 h-12 mb-4 opacity-50" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                            <p>Select a member from the list to analyze their expertise fit.</p>
                        </div>

                        <!-- Content State -->
                        <div id="comp-content"
                            class="hidden flex-1 overflow-y-auto custom-scroll p-6 grid grid-cols-1 xl:grid-cols-3 gap-6 items-start">



                            <!-- 1. Knowledge Overlay -->
                            <div class="flex flex-col items-center">
                                <h4
                                    class="text-sm font-bold text-slate-600 mb-4 uppercase tracking-wider w-full pb-2 border-b border-slate-100">
                                    Education score: <span id="comp-score-edu" class="text-blue-600 ml-1">0.0</span>
                                </h4>
                                <div id="comp-sphere" class="w-66 h-64 relative flex items-center justify-center">
                                    <!-- D3 Overlay Viz -->
                                </div>
                                <div class="mt-4 flex gap-4 text-xs">
                                    <div class="flex items-center"><span
                                            class="w-3 h-3 border border-dashed border-slate-400 rounded-full mr-2"></span>
                                        Target Zone</div>
                                    <div class="flex items-center"><span
                                            class="w-3 h-3 bg-slate-200 rounded-full mr-2"></span> Irrelevant</div>
                                </div>
                            </div>

                            <!-- 2. Experience Waterfall Comparison -->
                            <div>
                                <h4
                                    class="text-sm font-bold text-slate-600 mb-4 uppercase tracking-wider w-full pb-2 border-b border-slate-100">
                                    Experience score: <span id="comp-score-exp" class="text-blue-600 ml-1">0.0</span>
                                </h4>
                                <div class="grid grid-cols-2 gap-4 mb-2">
                                    <div>
                                        <div class="text-xs text-slate-500"></div>
                                        <div class="text-lg font-bold text-slate-700"><span id="comp-req-years"></span>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xs text-slate-500"></div>
                                        <div class="text-lg font-bold text-blue-600"><span id="comp-user-years"></span>
                                        </div>
                                    </div>
                                </div>
                                <div id="comp-waterfall" class="w-full h-[150px]">
                                    <!-- D3 Waterfall -->
                                </div>
                            </div>

                            <!-- 3. Resource Match -->
                            <div>
                                <h4
                                    class="text-sm font-bold text-slate-600 mb-4 uppercase tracking-wider w-full pb-2 border-b border-slate-100">
                                    Resource score: <span id="comp-score-res" class="text-blue-600 ml-1">0.0</span></h4>
                                <div id="comp-resources" class="flex flex-wrap gap-2"></div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- RIGHT BLOCK: Expert List -->
                <div
                    class="col-span-12 lg:col-span-2 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col overflow-hidden">
                    <div class="p-4 border-b border-slate-100 bg-slate-50">
                        <h4 class="font-bold text-slate-700">Expertise Scores</h4>
                        <p class="text-xs text-slate-500">Calculated for relevant members</p>
                    </div>
                    <div class="flex-1 overflow-y-auto custom-scroll p-0" id="expertise-list">
                        <!-- Populated by JS -->
                    </div>
                    <div class="p-3 bg-slate-50 text-center border-t border-slate-100 text-xs text-slate-400">
                        Scores based on Education, Experience & Resources
                    </div>
                </div>

            </div>

    </main>

    <!-- POPUP MODAL -->
    <div id="factor-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
            <div
                class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl border border-slate-200">
                <div
                    class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4 border-b border-slate-100 flex justify-between items-start">
                    <div>
                        <h3 class="text-lg font-semibold leading-6 text-slate-900" id="modal-title">Factor Analysis
                            Audit</h3>
                    </div>
                    <button type="button" class="text-slate-400 hover:text-slate-500" onclick="closeModal()">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div class="bg-white px-4 py-5 sm:p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <div class="mb-4">
                                <div class="text-xs font-bold text-slate-400 uppercase">Target User</div>
                                <div id="modal-username" class="text-xl font-bold text-slate-800">Username</div>
                                <div id="modal-status"
                                    class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 mt-1">
                                    Included</div>
                            </div>
                            <div class="mb-4 bg-slate-50 p-3 rounded-lg border border-slate-100">
                                <div class="flex justify-between items-end mb-1">
                                    <span class="text-sm font-medium text-slate-600">Total Relevance (R)</span>
                                    <span id="modal-score" class="text-2xl font-bold text-blue-600">0.00</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-2">
                                    <div id="modal-score-bar" class="bg-blue-600 h-2 rounded-full" style="width: 0%">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-sm font-bold text-slate-700 mb-2">System Reasoning</h4>
                                <div id="modal-reasoning"
                                    class="text-sm text-slate-600 space-y-2 bg-yellow-50 p-3 rounded border border-yellow-100 border-l-4 border-l-yellow-400">
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col">
                            <h4 class="text-sm font-bold text-slate-700 mb-2 text-center">Weighted Component
                                Contribution</h4>
                            <div class="chart-container" style="height: 250px;">
                                <canvas id="factorBarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 border-t border-slate-100">
                    <button type="button"
                        class="inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 sm:ml-3 sm:w-auto"
                        onclick="closeModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- EXPERTISE MODAL -->
    <div id="expertise-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity" onclick="closeExpertiseModal()">
        </div>
        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
            <div
                class="relative transform overflow-hidden rounded-xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-4xl border border-slate-200">
                <div class="bg-white px-6 py-4 border-b border-slate-100 flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold text-slate-900" id="exp-modal-username">User Profile</h3>
                        <p class="text-sm text-slate-500">Expertise Knowledge Map: Education & Experience & Resources
                        </p>
                    </div>
                    <button type="button" class="text-slate-400 hover:text-slate-500 transition-colors"
                        onclick="closeExpertiseModal()">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div class="bg-slate-50 p-6 overflow-y-auto max-h-[80vh]">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                        <!-- LEFT: Education Sphere -->
                        <div
                            class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex flex-col items-center">
                            <h4 class="text-sm font-bold text-slate-600 mb-4 uppercase tracking-wider">Education Sphere
                            </h4>
                            <div id="knowledge-sphere"
                                class="w-[420px] h-[380px] flex items-center justify-center relative">
                                <!-- D3 SVG will be injected here -->
                                <!-- Legend Overlay -->
                                <!-- 8-Point Compass Legend -->
                            </div>
                        </div>

                        <!-- RIGHT: Details -->
                        <div class="space-y-6">

                            <!-- Experience Waterfall -->
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h4 class="text-sm font-bold text-slate-600 mb-4 uppercase tracking-wider">Experience
                                    Records</h4>
                                <div id="experience-waterfall" class="w-full h-[160px]">
                                    <!-- D3/HTML Bars -->
                                </div>
                                <div class="mt-2 flex justify-between text-xs text-slate-400">
                                    <span>Career Start</span>
                                    <span>Present</span>
                                </div>
                            </div>

                            <!-- Resource Cloud -->
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h4 class="text-sm font-bold text-slate-600 mb-4 uppercase tracking-wider">Resource
                                    Cloud</h4>
                                <div id="resource-cloud" class="flex flex-wrap gap-2">
                                    <!-- Tags -->
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="explorer.js"></script>
    <script src="/script.js"></script>
</body>

</html>